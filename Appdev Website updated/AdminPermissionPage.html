<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin — Manage Permissions</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f8fa;
    --accent:#0b74d1;
    --muted:#6b7280;
    --card:#fff;
    --danger:#e11d48;
    --ok:#16a34a;
    --shadow: 0 8px 28px rgba(10,20,30,0.06);
    --radius:10px;
    --maxw:1100px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    color-scheme: light;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);-webkit-font-smoothing:antialiased;color:#0b1320}
  a{color:inherit}
  button{font-family:inherit}

  /* page layout */
  .page{display:flex;min-height:100vh}
  nav.sidebar{
    width:220px;background:#e9ecef;padding:28px 18px;border-right:1px solid rgba(11,17,20,0.03);display:flex;flex-direction:column;gap:18px;
  }
  nav.sidebar .logo{font-weight:800;font-size:18px;margin-bottom:6px}
  nav.sidebar a{display:block;padding:10px 12px;border-radius:8px;color:#111827;text-decoration:none;font-weight:600}
  nav.sidebar a.active{background:#fff;box-shadow:var(--shadow)}

  main.content{flex:1;padding:28px;max-width:var(--maxw);margin:0 auto;width:100%}

  header.h{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  header .title{font-size:22px;font-weight:800}
  header .actions{display:flex;gap:8px;align-items:center}

  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:var(--shadow);border:1px solid rgba(11,17,20,0.025)}

  /* controls row */
  .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
  .controls .search{display:flex;align-items:center;gap:8px}
  .controls input[type="search"], .controls select {padding:10px 12px;border-radius:8px;border:1px solid rgba(11,17,20,0.06);min-width:220px}
  .controls .btn{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
  .controls .btn.ghost{background:#fff;border:1px solid rgba(11,17,20,0.06);color:#0b1320}
  .controls .btn.danger{background:var(--danger);box-shadow:none}

  /* table */
  .table-wrap{overflow:auto;margin-top:12px}
  table{width:100%;border-collapse:collapse;font-size:14px}
  thead th{background:transparent;text-align:left;padding:12px 10px;color:var(--muted);font-weight:700;border-bottom:1px solid rgba(11,17,20,0.06)}
  tbody td{padding:12px 10px;border-bottom:1px solid rgba(11,17,20,0.03);vertical-align:middle}
  tbody tr:hover{background:linear-gradient(90deg,rgba(11,17,20,0.02),transparent)}
  .col-actions{width:160px;text-align:right}

  .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(11,17,20,0.04);font-weight:700;font-size:13px}

  /* table utilities */
  .user-small{font-weight:700;color:#0b1320}
  .muted{color:var(--muted);font-size:13px}

  /* form modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:80}
  .modal{width:520px;max-width:94%;background:var(--card);padding:18px;border-radius:10px;border:1px solid rgba(11,17,20,0.03)}
  .modal h3{margin:0 0 8px}
  .form-row{display:flex;gap:10px;margin-bottom:10px}
  .form-row .col{flex:1}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="text"], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(11,17,20,0.06);font-size:14px}
  .access-levels{display:flex;gap:8px;flex-wrap:wrap}
  .access-levels label{display:inline-flex;align-items:center;gap:8px;padding:6px 8px;border-radius:8px;border:1px solid rgba(11,17,20,0.06);background:#fafbfc;cursor:pointer}
  .small{font-size:13px;color:var(--muted)}
  .modal .buttons{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}

  /* responsive */
  @media (max-width:900px){
    nav.sidebar{display:none}
    .page{flex-direction:column}
    .modal{width:92%}
  }
</style>
</head>
<body>

<div class="page" role="application">
  <nav class="sidebar" aria-label="Main navigation">
    <div class="logo">Kumon Admin</div>
    <a href="#" class="">Dashboard</a>
    <a href="#" class="">Files</a>
    <a href="#" class="">Users</a>
    <a href="#" class="active">Permissions</a>
    <a href="#" class="">Logs</a>
  </nav>

  <main class="content" aria-label="Manage permissions">
    <header class="h">
      <div>
        <div class="title">Manage Permissions</div>
        <div class="muted">Add, edit and control file access for users</div>
      </div>

      <div class="actions">
        <button class="btn ghost" id="exportBtn">Export CSV</button>
        <button class="btn" id="addBtn">＋ Add Permission</button>
      </div>
    </header>

    <section class="card">
      <!-- controls -->
      <div class="controls">
        <div class="search">
          <input type="search" id="q" placeholder="Search file name or user...">
        </div>

        <select id="filterLevel" aria-label="Filter by access level">
          <option value="">All access levels</option>
          <option value="Read">Read</option>
          <option value="Write">Write</option>
          <option value="Admin">Admin</option>
        </select>

        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn ghost" id="bulkDeleteBtn">Delete selected</button>
          <button class="btn ghost" id="clearAllBtn">Clear all</button>
        </div>
      </div>

      <!-- table -->
      <div class="table-wrap">
        <table aria-label="Permissions table">
          <thead>
            <tr>
              <th style="width:48px"><input id="selectAll" type="checkbox" aria-label="Select all"></th>
              <th>File Name</th>
              <th>User</th>
              <th>Access Level</th>
              <th class="col-actions">Actions</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <!-- rows inserted by JS -->
          </tbody>
        </table>
      </div>
    </section>
  </main>
</div>

<!-- modal add/edit -->
<div class="modal-backdrop" id="modal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Add Permission</h3>

    <div class="form-row">
      <div class="col">
        <label for="fileSelect">Select File</label>
        <select id="fileSelect" aria-label="Select file"></select>
      </div>
      <div class="col">
        <label for="userSelect">Select User</label>
        <select id="userSelect" aria-label="Select user"></select>
      </div>
    </div>

    <div>
      <label>Access Level</label>
      <div class="access-levels" id="accessLevels">
        <label><input type="checkbox" value="Read"> Read</label>
        <label><input type="checkbox" value="Write"> Write</label>
        <label><input type="checkbox" value="Admin"> Admin</label>
      </div>
    </div>

    <div style="margin-top:10px">
      <label for="notes">Notes (optional)</label>
      <textarea id="notes" rows="3" placeholder="Internal note"></textarea>
    </div>

    <div class="buttons">
      <button class="btn ghost" id="cancelBtn">Cancel</button>
      <button class="btn" id="saveBtn">Save</button>
    </div>
  </div>
</div>

<script>
/* Admin Permissions — client-only demo
   Features:
   - list permissions, add/edit/delete
   - search + filter by access level
   - bulk delete + export CSV
   - localStorage persistence
*/

const STORAGE_KEY = 'admin_permissions_v1';
const SAMPLE_FILES = ['Report_Q1.pdf','Finance.xlsx','ProjectPlan.docx','Reading_Worksheet.pdf','Math_Packet.pdf'];
const SAMPLE_USERS = ['John Doe','Jane Smith','Alex Cruz','Maria Lopez','Samuel K.'];

// DOM refs
const tbody = document.getElementById('tbody');
const qInput = document.getElementById('q');
const filterLevel = document.getElementById('filterLevel');
const addBtn = document.getElementById('addBtn');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const fileSelect = document.getElementById('fileSelect');
const userSelect = document.getElementById('userSelect');
const accessLevels = document.getElementById('accessLevels');
const notes = document.getElementById('notes');
const saveBtn = document.getElementById('saveBtn');
const cancelBtn = document.getElementById('cancelBtn');
const exportBtn = document.getElementById('exportBtn');
const selectAllCb = document.getElementById('selectAll');
const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
const clearAllBtn = document.getElementById('clearAllBtn');

let permissions = load() || sampleData();
let editId = null; // if editing, id of permission

// populate selects for demo
function populateSelects(){
  fileSelect.innerHTML = SAMPLE_FILES.map(f => `<option value="${f}">${f}</option>`).join('');
  userSelect.innerHTML = SAMPLE_USERS.map(u => `<option value="${u}">${u}</option>`).join('');
}
populateSelects();

// render table
function render(){
  const q = (qInput.value||'').toLowerCase().trim();
  const levelFilter = filterLevel.value;
  const rows = permissions.filter(p=>{
    if(levelFilter && p.access !== levelFilter) return false;
    if(q && !(p.file.toLowerCase().includes(q) || p.user.toLowerCase().includes(q))) return false;
    return true;
  });

  tbody.innerHTML = rows.map(p => `
    <tr data-id="${p.id}">
      <td><input class="rowSel" type="checkbox" data-id="${p.id}"></td>
      <td><div class="user-small">${escapeHtml(p.file)}</div></td>
      <td><div class="muted">${escapeHtml(p.user)}</div></td>
      <td>${renderAccess(p.access)}</td>
      <td class="col-actions">
        <button class="btn ghost editBtn" data-id="${p.id}">Edit</button>
        <button class="btn ghost" data-id="${p.id}" onclick="deletePermission('${p.id}')">Delete</button>
      </td>
    </tr>`).join('') || '<tr><td colspan="5" class="muted">No permissions found</td></tr>';

  // wire edit buttons
  document.querySelectorAll('.editBtn').forEach(b => b.addEventListener('click', e => {
    const id = e.currentTarget.dataset.id;
    openEdit(id);
  }));

  // wire row checkboxes
  document.querySelectorAll('.rowSel').forEach(cb => cb.addEventListener('change', updateSelectAll));
}
render();

// helpers
function renderAccess(a){
  if(!a) return '<span class="badge muted">—</span>';
  if(a === 'Read') return '<span class="badge">Read</span>';
  if(a === 'Write') return '<span class="badge">Write</span>';
  if(a === 'Admin') return '<span class="badge" style="background:#fde68a;color:#a16207">Admin</span>';
  return `<span class="badge">${escapeHtml(a)}</span>`;
}

function uid(){ return 'p' + Math.random().toString(36).slice(2,9); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function load(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY)); }catch(e){return null;} }
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(permissions)); }

function sampleData(){
  // create small sample with singular access (most common)
  return [
    { id: uid(), file: 'Report_Q1.pdf', user: 'John Doe', access: 'Read', notes: '' },
    { id: uid(), file: 'Finance.xlsx', user: 'Jane Smith', access: 'Write', notes: '' },
    { id: uid(), file: 'ProjectPlan.docx', user: 'Alex Cruz', access: 'Admin', notes: '' }
  ];
}

// modal controls
addBtn.addEventListener('click', () => openAdd());
cancelBtn.addEventListener('click', closeModal);
modal.addEventListener('click', (e) => { if(e.target === modal) closeModal(); });

// open add
function openAdd(){
  editId = null;
  modalTitle.textContent = 'Add Permission';
  fileSelect.value = SAMPLE_FILES[0];
  userSelect.value = SAMPLE_USERS[0];
  notes.value = '';
  // reset access boxes
  accessLevels.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked = false);
  openModal();
}

// open edit for id
function openEdit(id){
  const p = permissions.find(x=>x.id===id); if(!p) return;
  editId = id;
  modalTitle.textContent = 'Edit Permission';
  fileSelect.value = p.file;
  userSelect.value = p.user;
  notes.value = p.notes || '';
  accessLevels.querySelectorAll('input[type="checkbox"]').forEach(cb=> cb.checked = (cb.value === p.access));
  openModal();
}

function openModal(){ modal.style.display = 'flex'; modal.setAttribute('aria-hidden','false'); }
function closeModal(){ modal.style.display = 'none'; modal.setAttribute('aria-hidden','true'); editId = null; }

// save handler
saveBtn.addEventListener('click', () => {
  const file = fileSelect.value.trim();
  const user = userSelect.value.trim();
  // pick the highest access selected (Admin > Write > Read). For the UI we use single selection mimic.
  let access = null;
  ['Admin','Write','Read'].forEach(level => {
    const cb = Array.from(accessLevels.querySelectorAll('input[type="checkbox"]')).find(i=>i.value===level);
    if(cb && cb.checked && !access) access = level;
  });

  if(!file || !user || !access){
    alert('Please select a file, a user and an access level (check one).');
    return;
  }

  if(editId){
    const p = permissions.find(x=>x.id===editId);
    if(!p) return;
    p.file = file; p.user = user; p.access = access; p.notes = notes.value.trim();
  } else {
    permissions.unshift({ id: uid(), file, user, access, notes: notes.value.trim() });
  }
  save();
  render();
  closeModal();
});

// delete single
function deletePermission(id){
  if(!confirm('Delete this permission?')) return;
  permissions = permissions.filter(p => p.id !== id);
  save();
  render();
}

// bulk delete
bulkDeleteBtn.addEventListener('click', () => {
  const selected = Array.from(document.querySelectorAll('.rowSel:checked')).map(cb=>cb.dataset.id);
  if(!selected.length) { alert('No rows selected'); return; }
  if(!confirm(`Delete ${selected.length} permission(s)?`)) return;
  permissions = permissions.filter(p => !selected.includes(p.id));
  save();
  render();
  selectAllCb.checked = false;
});

// clear all
clearAllBtn.addEventListener('click', () => {
  if(!confirm('Clear all permissions?')) return;
  permissions = [];
  save();
  render();
});

// export CSV
exportBtn.addEventListener('click', () => {
  if(!permissions.length){ alert('No permissions to export'); return; }
  const rows = [['file','user','access','notes']];
  permissions.forEach(p => rows.push([p.file,p.user,p.access,(p.notes||'').replace(/\n/g,' ')]));
  const csv = rows.map(r => r.map(c => `"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'permissions.csv'; a.click(); URL.revokeObjectURL(url);
});

// search & filter
qInput.addEventListener('input', render);
filterLevel.addEventListener('change', render);

// select all checkbox
selectAllCb.addEventListener('change', (e) => {
  document.querySelectorAll('.rowSel').forEach(cb => cb.checked = e.target.checked);
});

function updateSelectAll(){
  const all = Array.from(document.querySelectorAll('.rowSel'));
  const checked = all.filter(cb=>cb.checked).length;
  selectAllCb.checked = all.length && (checked === all.length);
}

// keyboard: Enter to open add modal when focused on search
qInput.addEventListener('keydown', (e) => {
  if(e.key === 'Enter'){ e.preventDefault(); openAdd(); }
});

// init: save sample if nothing in storage
if(!load()) save();

</script>
</body>
</html>
